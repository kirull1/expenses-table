# Expenses Table App

React-приложение для добавления расходов в Google Таблицу через REST API.

## Технологический стек

- React 18+ (функциональные компоненты, хуки)
- Material-UI (MUI) v5 для UI
- Axios для HTTP-запросов
- Formik + Yup для валидации форм
- Webpack для сборки
- React Router DOM для роутинга
- Framer Motion для анимаций
- Express для серверной части (аутентификация с сервисным аккаунтом)

## Особенности

- Адаптивный дизайн для всех устройств
- Темная/светлая тема с автоматическим определением системных настроек
- Валидация всех полей формы
- PWA с поддержкой офлайн-режима
- Анимации для улучшения пользовательского опыта
- Интеграция с Google Sheets API через сервисный аккаунт
- Расширенная поддержка переменных окружения для разных сред

## Установка и запуск

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/your-username/expenses-table.git
   cd expenses-table
   ```

2. Установить зависимости:
   ```bash
   npm install
   ```

3. Создать файл `.env` в корне проекта:
   ```bash
   cp .env.example .env
   ```
   
   Затем отредактируйте файл `.env` и добавьте ваши данные:
   ```
   # ID таблицы Google Sheets
   SPREADSHEET_ID=your_spreadsheet_id_here
   
   # Настройки сервисного аккаунта Google
   SERVICE_ACCOUNT_EMAIL=your_service_account_email@your-project.iam.gserviceaccount.com
   SERVICE_ACCOUNT_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYour private key content\n-----END PRIVATE KEY-----\n"
   
   # Порт для запуска серверной части
   PORT=3001
   ```
   
   **Важно**: Приложение работает только с действительными учетными данными сервисного аккаунта Google.
   
   Для более подробной информации о настройке переменных окружения, см. [ENV_SETUP.md](ENV_SETUP.md).

4. Запустить сервер для аутентификации:
   ```bash
   npm run server
   ```

5. В отдельном терминале запустить клиентское приложение в режиме разработки:
   ```bash
   npm run dev
   ```

6. Для сборки production-версии:
   ```bash
   npm run build
   ```

7. Для запуска production-версии (включая сервер и клиент):
   ```bash
   npm run start
   ```

## Архитектура приложения

Приложение состоит из двух частей:

1. **Клиентская часть (React)** - отвечает за отображение интерфейса и взаимодействие с пользователем.

2. **Серверная часть (Express)** - отвечает за аутентификацию с Google API через сервисный аккаунт и предоставление токена доступа клиентской части.

## Структура Google Таблицы

Приложение ожидает следующую структуру Google Таблицы:

1. Лист "Расходы" для добавления новых записей с колонками:
   - Дата
   - Категория
   - Стоимость
   - Комментарий
   - Автор

2. Лист "Справочники" со списком категорий в колонке B (начиная с B2)

3. Лист "Справочники" со списком авторов в колонке E (начиная с E2)

## Настройка Google API

1. Создайте проект в [Google Cloud Console](https://console.cloud.google.com/)
2. Включите Google Sheets API
3. Создайте сервисный аккаунт:
   - Перейдите в раздел "IAM & Admin" > "Service Accounts"
   - Нажмите "Create Service Account"
   - Заполните необходимые поля и предоставьте роль "Editor" для Google Sheets API
   - Создайте ключ в формате JSON для сервисного аккаунта
   - Используйте данные из скачанного JSON-файла для заполнения переменных окружения
4. Настройте доступ к вашей Google Таблице:
   - Откройте вашу таблицу и нажмите кнопку "Share"
   - Добавьте сервисный аккаунт (email) с правами редактирования
   - Проверьте, что структура таблицы соответствует ожидаемой

## Переменные окружения

Приложение использует следующие переменные окружения:

| Переменная | Описание | Пример |
|------------|----------|--------|
| SPREADSHEET_ID | ID Google таблицы (из URL) | 1qYY2AjIPocj7QpLsV5KOcyzTXMV-o2ETG2VkqvslpeQ |
| SERVICE_ACCOUNT_EMAIL | Email сервисного аккаунта | your-service-account@project-id.iam.gserviceaccount.com |
| SERVICE_ACCOUNT_PRIVATE_KEY | Приватный ключ сервисного аккаунта | -----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n |
| PORT | Порт для запуска сервера | 3001 |

Для расширенной настройки переменных окружения поддерживаются следующие файлы:

- `.env` - базовые переменные для всех сред
- `.env.development` - переменные для среды разработки
- `.env.production` - переменные для production среды
- `.env.local` - локальные переменные (не коммитятся в репозиторий)
- `.env.development.local` - локальные переменные для разработки
- `.env.production.local` - локальные переменные для production

Подробнее см. [ENV_SETUP.md](ENV_SETUP.md).

## Лицензия

MIT
